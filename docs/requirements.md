# 機能要件 (requirements)

## 概要
- 本 API は掛け算 (`/multiply`) と割り算 (`/divide`) の HTTP エンドポイントを提供する。
- 入力 `a`/`b` はクエリ文字列で与えられ、小数を許容する。
- 割り算で `b == 0` の場合は `200 OK` で結果を `"Infinity"` として返す。

## エンドポイント一覧
- `GET /multiply?a=<num>&b=<num>` — 掛け算を実行する。
- `GET /divide?a=<num>&b=<num>` — 割り算を実行する。
- 将来的に `POST /multiply`、`POST /divide` を JSON ボディで受け取る方式を追加可能。

## 入力仕様
- `a` と `b` は数値（小数可）とする。
- 両パラメータは必須。
- GET はクエリで送信、POST 時は JSON ボディ `{ "a": number, "b": number }` を想定。

## HTTP メソッド
- 主に GET を採用する。
- 互換性のため将来的に POST（JSON）を追加可能とする。

## レスポンス仕様（JSON / HTML）
- 成功（200）:
  - JSON 例: `{ "operation": "divide", "a": 1.2, "b": 0, "result": "Infinity" }`
  - `result` は数値または文字列 `"Infinity"` を許容する。
- エラー（400）: `{ "error": "BadRequest", "message": "説明" }`
- エラー（500）: `{ "error": "InternalError", "message": "説明" }`
- ブラウザ要求時は簡易 HTML を返し、同一情報を人間可読で表示する。

> 注: JSON を常に返せるようにし、Accept ヘッダで API/HTML を切替できること。

## 入力検証とエラーハンドリング
- 未指定・解析不能な値は 400 Bad Request を返す。
- `b == 0` の割り算は 200 OK とし `result: "Infinity"` を返す。
- 大きすぎる数・非数値は検査して 400 を返す。

## ログ要件
- リクエストID、タイムスタンプ、クライアントIP、`a`/`b`、処理結果、遅延時間、例外をログに記録する。
- 個人情報（PII）は記録しないかマスクする。

## テスト要件
- 単体テスト: 演算ロジック（正負・小数・ゼロ）を網羅する。
- 統合テスト: GET/POST の HTTP レスポンスと HTML レンダリングを含める。
- エッジケース: `b == 0`、不正入力、大きな数、精度検証を含める。

## 未決事項・選択肢
- CORS 設定（許可するオリジンの範囲）。
- レート制限の閾値と実装方法（将来的に API Management などで制御）。
- `a`/`b` の精度制限（有効桁数、Decimal 利用の有無）。
- HTML のテンプレート仕様（スタイル、ブランド）。
- エラーメッセージの国際化（日本語/英語）。